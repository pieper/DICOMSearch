<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
      <title>C.20 Spatial Registration</title>
      <link rel="stylesheet" type="text/css" href="dicom.css" />
      <meta name="generator" content="DocBook XSL Stylesheets V1.78.1" />
      <link rel="home" href="PS3.3.html" title="PS3.3" />
      <link rel="up" href="chapter_C.html" title="C Information Module Definitions (Normative)" />
      <link rel="prev" href="sect_C.19.html" title="C.19 Raw Data Specific Modules" />
      <link rel="next" href="sect_C.21.html" title="C.21 Spatial Fiducials" />
      <style type="text/css"><![CDATA[
	p { font-size: 15px; }
      ]]></style>
   </head>
   <body>
      <div class="navheader">
         <table width="100%" summary="Navigation header">
            <tr>
               <th colspan="3" align="center" rowspan="1">C.20 Spatial Registration</th>
            </tr>
            <tr>
               <td width="20%" align="left" rowspan="1" colspan="1">
                  <a accesskey="p" href="sect_C.19.html" shape="rect">Prev</a> </td>
               <th width="60%" align="center" rowspan="1" colspan="1">C Information Module Definitions (Normative)</th>
               <td width="20%" align="right" rowspan="1" colspan="1"> <a accesskey="n" href="sect_C.21.html" shape="rect">Next</a>
               </td>
            </tr>
         </table>
         <hr />
      </div>
      <div class="section">
         <div class="titlepage">
            <div>
               <div>
                  <h2 class="title" style="clear: both">
                     <a id="sect_C.20" shape="rect"></a>C.20 Spatial Registration</h2>
               </div>
            </div>
         </div>
         <div class="section">
            <div class="titlepage">
               <div>
                  <div>
                     <h3 class="title">
                        <a id="sect_C.20.1" shape="rect"></a>C.20.1 Spatial Registration Series Module</h3>
                  </div>
               </div>
            </div>
            <p>
               <a class="xref" href="sect_C.20.html#table_C.20.1-1" title="Table C.20.1-1. Spatial Registration Series Module Attributes" shape="rect">Table C.20.1-1</a> defines the general Attributes of the Spatial Registration Series Module.</p>
            <div class="table">
               <a id="table_C.20.1-1" shape="rect"></a>
               <p class="title">
                  <strong>Table C.20.1-1. Spatial Registration Series Module Attributes</strong>
               </p>
               <div class="table-contents">
                  <table frame="box" rules="all">
                     <thead>
                        <tr valign="top">
                           <th align="center" rowspan="1" colspan="1">
                              <p>Attribute Name</p>
                           </th>
                           <th align="center" rowspan="1" colspan="1">
                              <p>Tag</p>
                           </th>
                           <th align="center" rowspan="1" colspan="1">
                              <p>Type</p>
                           </th>
                           <th align="center" rowspan="1" colspan="1">
                              <p>Attribute Description</p>
                           </th>
                        </tr>
                     </thead>
                     <tbody>
                        <tr valign="top">
                           <td align="left" rowspan="1" colspan="1">
                              <p>Modality</p>
                           </td>
                           <td align="center" rowspan="1" colspan="1">
                              <p>(0008,0060)</p>
                           </td>
                           <td align="center" rowspan="1" colspan="1">
                              <p>1</p>
                           </td>
                           <td align="left" rowspan="1" colspan="1">
                              <p>Modality type.</p>
                              <div class="variablelist">
                                 <p class="title">
                                    <strong>Enumerated Values:</strong>
                                 </p>
                                 <dl class="variablelist compact">
                                    <dt>
                                       <span class="term">REG</span>
                                    </dt>
                                    <dd>
                                       <p></p>
                                    </dd>
                                 </dl>
                              </div>
                           </td>
                        </tr>
                     </tbody>
                  </table>
               </div>
            </div>
            <br class="table-break" clear="none" />
         </div>
         <div class="section">
            <div class="titlepage">
               <div>
                  <div>
                     <h3 class="title">
                        <a id="sect_C.20.2" shape="rect"></a>C.20.2 Spatial Registration Module</h3>
                  </div>
               </div>
            </div>
            <p>
               <a class="xref" href="sect_C.20.html#table_C.20.2-1" title="Table C.20.2-1. Spatial Registration Module Attributes" shape="rect">Table C.20.2-1</a> defines the general Attributes of the Spatial Registration Module.</p>
            <div class="table">
               <a id="table_C.20.2-1" shape="rect"></a>
               <p class="title">
                  <strong>Table C.20.2-1. Spatial Registration Module Attributes</strong>
               </p>
               <div class="table-contents">
                  <table frame="box" rules="all">
                     <thead>
                        <tr valign="top">
                           <th align="center" rowspan="1" colspan="1">
                              <p>Attribute Name</p>
                           </th>
                           <th align="center" rowspan="1" colspan="1">
                              <p>Tag</p>
                           </th>
                           <th align="center" rowspan="1" colspan="1">
                              <p>Type</p>
                           </th>
                           <th align="center" rowspan="1" colspan="1">
                              <p>Attribute Description</p>
                           </th>
                        </tr>
                     </thead>
                     <tbody>
                        <tr valign="top">
                           <td align="left" rowspan="1" colspan="1">
                              <p>Content Date</p>
                           </td>
                           <td align="center" rowspan="1" colspan="1">
                              <p>(0008,0023)</p>
                           </td>
                           <td align="center" rowspan="1" colspan="1">
                              <p>1</p>
                           </td>
                           <td align="left" rowspan="1" colspan="1">
                              <p>The date the content creation started.</p>
                           </td>
                        </tr>
                        <tr valign="top">
                           <td align="left" rowspan="1" colspan="1">
                              <p>Content Time</p>
                           </td>
                           <td align="center" rowspan="1" colspan="1">
                              <p>(0008,0033)</p>
                           </td>
                           <td align="center" rowspan="1" colspan="1">
                              <p>1</p>
                           </td>
                           <td align="left" rowspan="1" colspan="1">
                              <p>The time the content creation started.</p>
                           </td>
                        </tr>
                        <tr valign="top">
                           <td align="left" colspan="3" rowspan="1">
                              <p>
                                 <span class="italic">Include <a class="xref" href="sect_10.9.html#table_10-12" title="Table 10-12. Content Identification Macro Attributes" shape="rect">Table 10-12 “Content Identification Macro Attributes”</a>
                                 </span>
                              </p>
                           </td>
                           <td align="left" rowspan="1" colspan="1">
                              <p></p>
                           </td>
                        </tr>
                        <tr valign="top">
                           <td align="left" rowspan="1" colspan="1">
                              <p>Registration Sequence</p>
                           </td>
                           <td align="center" rowspan="1" colspan="1">
                              <p>(0070,0308)</p>
                           </td>
                           <td align="center" rowspan="1" colspan="1">
                              <p>1</p>
                           </td>
                           <td align="left" rowspan="1" colspan="1">
                              <p>A sequence of registration items. Each item defines a spatial registration of the images referenced in that item to the Registered RCS established by this SOP instance. All referenced images are in the same spatial frame of reference or atlas.</p>
                              <p>One or more Items shall be included in this sequence.</p>
                           </td>
                        </tr>
                        <tr valign="top">
                           <td align="left" rowspan="1" colspan="1">
                              <p>&gt;Frame of Reference UID</p>
                           </td>
                           <td align="center" rowspan="1" colspan="1">
                              <p>(0020,0052)</p>
                           </td>
                           <td align="center" rowspan="1" colspan="1">
                              <p>1C</p>
                           </td>
                           <td align="left" rowspan="1" colspan="1">
                              <p>Identifies the Frame of Reference of the referenced data, that may or may not be an image set (e.g., atlas or physical space). See <a class="xref" href="sect_C.7.html#sect_C.7.4.1.1.1" title="C.7.4.1.1.1 Frame of Reference UID" shape="rect">Section C.7.4.1.1.1</a> for further explanation.</p>
                              <p>Required if Referenced Image Sequence (0008,1140) is absent. May be present otherwise.</p>
                           </td>
                        </tr>
                        <tr valign="top">
                           <td align="left" rowspan="1" colspan="1">
                              <p>&gt;Referenced Image Sequence</p>
                           </td>
                           <td align="center" rowspan="1" colspan="1">
                              <p>(0008,1140)</p>
                           </td>
                           <td align="center" rowspan="1" colspan="1">
                              <p>1C</p>
                           </td>
                           <td align="left" rowspan="1" colspan="1">
                              <p>Identifies the set of images of the referenced data, registered in this sequence item.</p>
                              <p>One or more Items shall be included in this sequence.</p>
                              <p>Required if Frame of Reference UID (0020,0052) is absent. May be present otherwise.</p>
                           </td>
                        </tr>
                        <tr valign="top">
                           <td align="left" colspan="3" rowspan="1">
                              <p>
                                 <span class="italic">&gt;&gt;Include <a class="xref" href="sect_10.3.html#table_10-3" title="Table 10-3. Image SOP Instance Reference Macro Attributes" shape="rect">Table 10-3 “Image SOP Instance Reference Macro Attributes”</a>
                                 </span>
                              </p>
                           </td>
                           <td align="left" rowspan="1" colspan="1">
                              <p></p>
                           </td>
                        </tr>
                        <tr valign="top">
                           <td align="left" rowspan="1" colspan="1">
                              <p>&gt;Matrix Registration Sequence</p>
                           </td>
                           <td align="center" rowspan="1" colspan="1">
                              <p>(0070,0309)</p>
                           </td>
                           <td align="center" rowspan="1" colspan="1">
                              <p>1</p>
                           </td>
                           <td align="left" rowspan="1" colspan="1">
                              <p>A sequence that specifies one spatial registration.</p>
                              <p>Only a single Item shall be included in this sequence.</p>
                           </td>
                        </tr>
                        <tr valign="top">
                           <td align="left" rowspan="1" colspan="1">
                              <p>&gt;&gt;Frame of Reference Transformation Comment</p>
                           </td>
                           <td align="center" rowspan="1" colspan="1">
                              <p>(3006,00C8)</p>
                           </td>
                           <td align="center" rowspan="1" colspan="1">
                              <p>3</p>
                           </td>
                           <td align="left" rowspan="1" colspan="1">
                              <p>User description or comments about the registration.</p>
                           </td>
                        </tr>
                        <tr valign="top">
                           <td align="left" rowspan="1" colspan="1">
                              <p>&gt;&gt;Registration Type Code Sequence</p>
                           </td>
                           <td align="center" rowspan="1" colspan="1">
                              <p>(0070,030D)</p>
                           </td>
                           <td align="center" rowspan="1" colspan="1">
                              <p>2</p>
                           </td>
                           <td align="left" rowspan="1" colspan="1">
                              <p>Describes the information input into the registration process.</p>
                              <p>Zero or one Item shall be included in this Sequence.</p>
                           </td>
                        </tr>
                        <tr valign="top">
                           <td align="left" colspan="3" rowspan="1">
                              <p>
                                 <span class="italic">&gt;&gt;&gt;Include <a class="xref" href="sect_8.8.html#table_8.8-1" title="Table 8.8-1. Code Sequence Macro Attributes" shape="rect">Table 8.8-1 “Code Sequence Macro Attributes”</a>
                                 </span>
                              </p>
                           </td>
                           <td align="left" rowspan="1" colspan="1">
                              <p>
                                 <span class="italic">Baseline <a href="../part16/sect_CID_7100.html" class="olink" shape="rect">CID 7100 “RCS Registration Method Type”</a>.</span>
                              </p>
                           </td>
                        </tr>
                        <tr valign="top">
                           <td align="left" rowspan="1" colspan="1">
                              <p>&gt;&gt;Matrix Sequence</p>
                           </td>
                           <td align="center" rowspan="1" colspan="1">
                              <p>(0070,030A)</p>
                           </td>
                           <td align="center" rowspan="1" colspan="1">
                              <p>1</p>
                           </td>
                           <td align="left" rowspan="1" colspan="1">
                              <p>Specifies one transformation, that registers the Source RCS/images to the Registered RCS. It is expressible as multiple matrices, each in a separate item of the sequence.</p>
                              <p>One or more Items shall be included in this sequence.</p>
                              <p>The item order is significant and corresponds to matrix multiplication order. See <a class="xref" href="sect_C.20.html#sect_C.20.2.1.1" title="C.20.2.1.1 Frame of Reference Transformation Matrix" shape="rect">Section C.20.2.1.1</a>.</p>
                           </td>
                        </tr>
                        <tr valign="top">
                           <td align="left" rowspan="1" colspan="1">
                              <p>&gt;&gt;&gt;Frame of Reference Transformation Matrix</p>
                           </td>
                           <td align="center" rowspan="1" colspan="1">
                              <p>(3006,00C6)</p>
                           </td>
                           <td align="center" rowspan="1" colspan="1">
                              <p>1</p>
                           </td>
                           <td align="left" rowspan="1" colspan="1">
                              <p>A 4x4 affine transformation matrix that registers a homogeneous coordinate system A to B. Matrix elements shall be listed in row-major order. See <a class="xref" href="sect_C.20.html#sect_C.20.2.1.1" title="C.20.2.1.1 Frame of Reference Transformation Matrix" shape="rect">Section C.20.2.1.1</a>.</p>
                           </td>
                        </tr>
                        <tr valign="top">
                           <td align="left" rowspan="1" colspan="1">
                              <p>&gt;&gt;&gt;Frame of Reference Transformation Matrix Type</p>
                           </td>
                           <td align="center" rowspan="1" colspan="1">
                              <p>(0070,030C)</p>
                           </td>
                           <td align="center" rowspan="1" colspan="1">
                              <p>1</p>
                           </td>
                           <td align="left" rowspan="1" colspan="1">
                              <p>Type of Frame of Reference Transformation Matrix (3006,00C6).</p>
                              <div class="variablelist">
                                 <p class="title">
                                    <strong>Enumerated Values:</strong>
                                 </p>
                                 <dl class="variablelist compact">
                                    <dt>
                                       <span class="term">RIGID</span>
                                    </dt>
                                    <dd>
                                       <p></p>
                                    </dd>
                                    <dt>
                                       <span class="term">RIGID_SCALE</span>
                                    </dt>
                                    <dd>
                                       <p></p>
                                    </dd>
                                    <dt>
                                       <span class="term">AFFINE</span>
                                    </dt>
                                    <dd>
                                       <p></p>
                                    </dd>
                                 </dl>
                              </div>
                              <p>See <a class="xref" href="sect_C.20.html#sect_C.20.2.1.2" title="C.20.2.1.2 Frame of Reference Transformation Matrix Type" shape="rect">Section C.20.2.1.2</a>
                              </p>
                           </td>
                        </tr>
                        <tr valign="top">
                           <td align="left" rowspan="1" colspan="1">
                              <p>&gt;Used Fiducials Sequence</p>
                           </td>
                           <td align="center" rowspan="1" colspan="1">
                              <p>(0070,0314)</p>
                           </td>
                           <td align="center" rowspan="1" colspan="1">
                              <p>3</p>
                           </td>
                           <td align="left" rowspan="1" colspan="1">
                              <p>The fiducials used to determine the Frame of Reference Transformation Matrix.</p>
                              <p>One or more Items are permitted in this sequence.</p>
                           </td>
                        </tr>
                        <tr valign="top">
                           <td align="left" colspan="3" rowspan="1">
                              <p>
                                 <span class="italic">&gt;&gt;Include <a class="xref" href="sect_10.8.html#table_10-11" title="Table 10-11. SOP Instance Reference Macro Attributes" shape="rect">Table 10-11 “SOP Instance Reference Macro Attributes”</a>
                                 </span>
                              </p>
                           </td>
                           <td align="left" rowspan="1" colspan="1">
                              <p>Reference to the Spatial Fiducial SOP Instance identifying the Used Fiducial(s)</p>
                           </td>
                        </tr>
                        <tr valign="top">
                           <td align="left" rowspan="1" colspan="1">
                              <p>&gt;&gt;Fiducial UID</p>
                           </td>
                           <td align="center" rowspan="1" colspan="1">
                              <p>(0070,031A)</p>
                           </td>
                           <td align="center" rowspan="1" colspan="1">
                              <p>1</p>
                           </td>
                           <td align="left" rowspan="1" colspan="1">
                              <p>The UID that identifies the fiducial used as registration input.</p>
                           </td>
                        </tr>
                        <tr valign="top">
                           <td align="left" rowspan="1" colspan="1">
                              <p>&gt;Used Segments Sequence</p>
                           </td>
                           <td align="center" rowspan="1" colspan="1">
                              <p>(0062,0012)</p>
                           </td>
                           <td align="center" rowspan="1" colspan="1">
                              <p>3</p>
                           </td>
                           <td align="left" rowspan="1" colspan="1">
                              <p>The segments used to determine the Frame of Reference Transformation Matrix.</p>
                              <p>One or more Items are permitted in this sequence.</p>
                           </td>
                        </tr>
                        <tr valign="top">
                           <td align="left" colspan="3" rowspan="1">
                              <p>
                                 <span class="italic">&gt;&gt;Include <a class="xref" href="sect_10.8.html#table_10-11" title="Table 10-11. SOP Instance Reference Macro Attributes" shape="rect">Table 10-11 “SOP Instance Reference Macro Attributes”</a>
                                 </span>
                              </p>
                           </td>
                           <td align="left" rowspan="1" colspan="1">
                              <p>Reference to the Segmentation or Surface Segmentation SOP Instance identifying the Used Segments.</p>
                           </td>
                        </tr>
                        <tr valign="top">
                           <td align="left" rowspan="1" colspan="1">
                              <p>&gt;&gt;Referenced Segment Number</p>
                           </td>
                           <td align="center" rowspan="1" colspan="1">
                              <p>(0062,000B)</p>
                           </td>
                           <td align="center" rowspan="1" colspan="1">
                              <p>1</p>
                           </td>
                           <td align="left" rowspan="1" colspan="1">
                              <p>Uniquely identifies the segment described in Segment Sequence (0062,0002) by reference to Segment Number (0062,0004). Referenced Segment Number (0062,000B) shall not be multi-valued.</p>
                           </td>
                        </tr>
                     </tbody>
                  </table>
               </div>
            </div>
            <br class="table-break" clear="none" />
            <div class="section">
               <div class="titlepage">
                  <div>
                     <div>
                        <h4 class="title">
                           <a id="sect_C.20.2.1" shape="rect"></a>C.20.2.1 Registration Module Attribute Descriptions</h4>
                     </div>
                  </div>
               </div>
               <div class="section">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h5 class="title">
                              <a id="sect_C.20.2.1.1" shape="rect"></a>C.20.2.1.1 Frame of Reference Transformation Matrix</h5>
                        </div>
                     </div>
                  </div>
                  <p>The Frame of Reference Transformation Matrix (3006,00C6) <sup>A</sup>M<sub>B</sub> describes how to transform a point (<sup>B</sup>x,<sup>B</sup>y,<sup>B</sup>z) with respect to RCS<sub>B</sub> into (<sup>A</sup>x,<sup>A</sup>y,<sup>A</sup>z) with respect to RCS<sub>A</sub> according to <a class="xref" href="sect_C.20.html#equation_C.20.2-1" title="Equation C.20.2-1. " shape="rect">Equation C.20.2-1</a>.</p>
                  <p>
              </p>
                  <div class="equation">
                     <a id="equation_C.20.2-1" shape="rect"></a>
                     <p class="title">
                        <strong>Equation C.20.2-1. </strong>
                     </p>
                     <div class="equation-contents">
                        <object type="image/svg+xml" data="sect_C_image_1.svg" style="">
                           <param name="src" value="image_1.svg" />
                        </object>
                     </div>
                  </div>
                  <p>
                     <br class="equation-break" clear="none" />
                  </p>
                  <p>The Matrix Registration is expressible as multiple matrices, each in a separate item of Matrix Sequence (0070,030A). <a class="xref" href="sect_C.20.html#equation_C.20.2-2" title="Equation C.20.2-2. " shape="rect">Equation C.20.2-2</a> specifies the order of the matrix multiplication where 
            <span class="bold">
                        <strong>M<sub>1</sub>
                        </strong>
                     </span>, 
            <span class="bold">
                        <strong>M<sub>2</sub>
                        </strong>
                     </span> and 
            <span class="bold">
                        <strong>M<sub>3</sub>
                        </strong>
                     </span> are the first, second and third items in the sequence.</p>
                  <p>
              </p>
                  <div class="equation">
                     <a id="equation_C.20.2-2" shape="rect"></a>
                     <p class="title">
                        <strong>Equation C.20.2-2. </strong>
                     </p>
                     <div class="equation-contents">
                        <object type="image/svg+xml" data="sect_C_image_2.svg" style="">
                           <param name="src" value="image_2.svg" />
                        </object>
                     </div>
                  </div>
                  <p>
                     <br class="equation-break" clear="none" />
                  </p>
                  <p>where</p>
                  <p>
              </p>
                  <div class="informalequation">
                     <object type="image/svg+xml" data="sect_C_image_3.svg" style="position: relative; bottom: -27.525px;">
                        <param name="src" value="image_3.svg" />
                     </object>
                  </div>
                  <p>
            </p>
                  <p>Registration often involves two or more RCS, each with a corresponding Frame of Reference Transformation Matrix. For example, another Frame of Reference Transformation Matrix <sup>A</sup>M<sub>C</sub> can describe how to transform a point (<span class="italic">
                        <sup>C</sup>x,<sup>C</sup>y,<sup>C</sup>z</span>) with respect to RCS 
              <span class="italic">
                        <sub>C</sub>
                     </span> into (<span class="italic">
                        <sup>A</sup>x,<sup>A</sup>y,<sup>A</sup>z</span>) with respect to RCS<sub>A</sub>. It is straightforward to find the Frame of Reference Transformation Matrix <span class="italic">
                        <sup>B</sup>
                     </span>M<span class="italic">
                        <sub>C</sub>
                     </span> that describes how to transform the point (<span class="italic">
                        <sup>C</sup>x,<sup>C</sup>y,<sup>C</sup>z</span>) with respect to RCS<sub>C</sub> into the point (<span class="italic">
                        <sup>B</sup>x,<sup>B</sup>y,<sup>B</sup>z</span>) with respect to RCS<sub>B</sub>. The solution is to invert <sup>A</sup>M<sub>B</sub> and multiply by <sup>A</sup>M<sub>C</sub>, as shown in <a class="xref" href="sect_C.20.html#equation_C.20.2-3" title="Equation C.20.2-3. " shape="rect">Equation C.20.2-3</a>.</p>
                  <p>
              </p>
                  <div class="equation">
                     <a id="equation_C.20.2-3" shape="rect"></a>
                     <p class="title">
                        <strong>Equation C.20.2-3. </strong>
                     </p>
                     <div class="equation-contents">
                        <object type="image/svg+xml" data="sect_C_image_4.svg" style="">
                           <param name="src" value="image_4.svg" />
                        </object>
                     </div>
                  </div>
                  <p>
                     <br class="equation-break" clear="none" />
                  </p>
                  <p>If two or more transformation matrices describe the relation between Patient coordinates and a device-centric Well-known Frame of Reference, any calculations assuming transitivity via the Well-known Frame of Reference must be performed with great care to assure that both registrations reflect the same positioning of the patient with respect to the common Well-known Frame of Reference.</p>
               </div>
               <div class="section">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h5 class="title">
                              <a id="sect_C.20.2.1.2" shape="rect"></a>C.20.2.1.2 Frame of Reference Transformation Matrix Type</h5>
                        </div>
                     </div>
                  </div>
                  <p>There are three types of Registration Matrices:</p>
                  <p>RIGID: This is a registration involving only translations and rotations. Mathematically, the matrix is constrained to be orthonormal and describes six degrees of freedom: three translations, and three rotations.</p>
                  <p>RIGID_SCALE: This is a registration involving only translations, rotations and scaling. Mathematically, the matrix is constrained to be orthogonal and describes nine degrees of freedom: three translations, three rotations and three scales. This type of transformation is sometimes used in atlas mapping.</p>
                  <p>AFFINE: This is a registration involving translations, rotations, scaling and shearing. Mathematically, there are no constraints on the elements of the Frame of Reference Transformation Matrix other than that the last row shall be (0,0,0,1) to preserve the homogeneous coordinates, so it conveys twelve degrees of freedom. This type of transformation is sometimes used in atlas mapping.</p>
                  <div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
                     <h3 class="title">Note</h3>
                     <p>The AFFINE value for Frame of Reference Transformation Matrix Type (0070,030C) has the same meaning as the use of the HOMOGENEOUS value for Frame of Reference Transformation Type (3006,00C4) in the Structure Set module. See <a class="xref" href="sect_C.8.html#sect_C.8.8.5" title="C.8.8.5 Structure Set Module" shape="rect">Section C.8.8.5</a>.</p>
                  </div>
                  <p>See <a href="../part17/chapter_P.html" class="olink" shape="rect"> Annex P “Transforms and Mappings (Informative)” in PS3.17</a> for more detail.</p>
               </div>
            </div>
         </div>
         <div class="section">
            <div class="titlepage">
               <div>
                  <div>
                     <h3 class="title">
                        <a id="sect_C.20.3" shape="rect"></a>C.20.3 Deformable Spatial Registration Module</h3>
                  </div>
               </div>
            </div>
            <p>
               <a class="xref" href="sect_C.20.html#table_C.20.3-1" title="Table C.20.3-1. Deformable Spatial Registration Module Attributes" shape="rect">Table C.20.3-1</a> defines the general Attributes of the Deformable Spatial Registration Module.</p>
            <div class="table">
               <a id="table_C.20.3-1" shape="rect"></a>
               <p class="title">
                  <strong>Table C.20.3-1. Deformable Spatial Registration Module Attributes</strong>
               </p>
               <div class="table-contents">
                  <table frame="box" rules="all">
                     <thead>
                        <tr valign="top">
                           <th align="center" rowspan="1" colspan="1">
                              <p>Attribute Name</p>
                           </th>
                           <th align="center" rowspan="1" colspan="1">
                              <p>Tag</p>
                           </th>
                           <th align="center" rowspan="1" colspan="1">
                              <p>Type</p>
                           </th>
                           <th align="center" rowspan="1" colspan="1">
                              <p>Attribute Description</p>
                           </th>
                        </tr>
                     </thead>
                     <tbody>
                        <tr valign="top">
                           <td align="left" rowspan="1" colspan="1">
                              <p>Content Date</p>
                           </td>
                           <td align="center" rowspan="1" colspan="1">
                              <p>(0008,0023)</p>
                           </td>
                           <td align="center" rowspan="1" colspan="1">
                              <p>1</p>
                           </td>
                           <td align="left" rowspan="1" colspan="1">
                              <p>The date the vector grid data creation started.</p>
                           </td>
                        </tr>
                        <tr valign="top">
                           <td align="left" rowspan="1" colspan="1">
                              <p>Content Time</p>
                           </td>
                           <td align="center" rowspan="1" colspan="1">
                              <p>(0008,0033)</p>
                           </td>
                           <td align="center" rowspan="1" colspan="1">
                              <p>1</p>
                           </td>
                           <td align="left" rowspan="1" colspan="1">
                              <p>The time the vector grid data creation started.</p>
                           </td>
                        </tr>
                        <tr valign="top">
                           <td align="left" colspan="3" rowspan="1">
                              <p>
                                 <span class="italic">Include <a class="xref" href="sect_10.9.html#table_10-12" title="Table 10-12. Content Identification Macro Attributes" shape="rect">Table 10-12 “Content Identification Macro Attributes”</a>
                                 </span>
                              </p>
                           </td>
                           <td align="left" rowspan="1" colspan="1">
                              <p></p>
                           </td>
                        </tr>
                        <tr valign="top">
                           <td align="left" rowspan="1" colspan="1">
                              <p>Deformable Registration Sequence</p>
                           </td>
                           <td align="center" rowspan="1" colspan="1">
                              <p>(0064,0002)</p>
                           </td>
                           <td align="center" rowspan="1" colspan="1">
                              <p>1</p>
                           </td>
                           <td align="left" rowspan="1" colspan="1">
                              <p>A sequence of registration items. Each item defines a spatial registration to the referenced images in that item. At least one item shall have a Deformable Registration Grid Sequence (0064,0005) with one item. See <a class="xref" href="sect_C.20.html#sect_C.20.3.1.1" title="C.20.3.1.1 Deformable Registration Sequence Application" shape="rect">Section C.20.3.1.1</a>.</p>
                              <p>One or more Items shall be included in this sequence.</p>
                           </td>
                        </tr>
                        <tr valign="top">
                           <td align="left" rowspan="1" colspan="1">
                              <p>&gt;Source Frame of Reference UID</p>
                           </td>
                           <td align="center" rowspan="1" colspan="1">
                              <p>(0064,0003)</p>
                           </td>
                           <td align="center" rowspan="1" colspan="1">
                              <p>1</p>
                           </td>
                           <td align="left" rowspan="1" colspan="1">
                              <p>Identifies the Frame of Reference of a Source RCS. The Source RCS may or may not include an image set (e.g., atlas). See <a class="xref" href="sect_C.7.html#sect_C.7.4.1.1.1" title="C.7.4.1.1.1 Frame of Reference UID" shape="rect">Section C.7.4.1.1.1</a> for further explanation.</p>
                           </td>
                        </tr>
                        <tr valign="top">
                           <td align="left" rowspan="1" colspan="1">
                              <p>&gt;Referenced Image Sequence</p>
                           </td>
                           <td align="center" rowspan="1" colspan="1">
                              <p>(0008,1140)</p>
                           </td>
                           <td align="center" rowspan="1" colspan="1">
                              <p>1C</p>
                           </td>
                           <td align="left" rowspan="1" colspan="1">
                              <p>Identifies the set of images registered in this sequence item.</p>
                              <p>One or more Items shall be included in this sequence.</p>
                              <p>Required if the registration applies to a subset of images within the specified Source Frame of Reference UID (0064,0003). All referenced images shall be in the same spatial frame of reference.</p>
                           </td>
                        </tr>
                        <tr valign="top">
                           <td align="left" colspan="3" rowspan="1">
                              <p>
                                 <span class="italic">&gt;&gt;Include <a class="xref" href="sect_10.3.html#table_10-3" title="Table 10-3. Image SOP Instance Reference Macro Attributes" shape="rect">Table 10-3 “Image SOP Instance Reference Macro Attributes”</a>
                                 </span>
                              </p>
                           </td>
                           <td align="left" rowspan="1" colspan="1">
                              <p></p>
                           </td>
                        </tr>
                        <tr valign="top">
                           <td align="left" rowspan="1" colspan="1">
                              <p>&gt;Frame of Reference Transformation Comment</p>
                           </td>
                           <td align="center" rowspan="1" colspan="1">
                              <p>(3006,00C8)</p>
                           </td>
                           <td align="center" rowspan="1" colspan="1">
                              <p>3</p>
                           </td>
                           <td align="left" rowspan="1" colspan="1">
                              <p>User description or comments about the registration.</p>
                           </td>
                        </tr>
                        <tr valign="top">
                           <td align="left" rowspan="1" colspan="1">
                              <p>&gt;Registration Type Code Sequence</p>
                           </td>
                           <td align="center" rowspan="1" colspan="1">
                              <p>(0070,030D)</p>
                           </td>
                           <td align="center" rowspan="1" colspan="1">
                              <p>2</p>
                           </td>
                           <td align="left" rowspan="1" colspan="1">
                              <p>Describes the method used for the registration process.</p>
                              <p>Zero or one Item shall be included in this sequence.</p>
                           </td>
                        </tr>
                        <tr valign="top">
                           <td align="left" colspan="3" rowspan="1">
                              <p>
                                 <span class="italic">&gt;&gt;Include <a class="xref" href="sect_8.8.html#table_8.8-1" title="Table 8.8-1. Code Sequence Macro Attributes" shape="rect">Table 8.8-1 “Code Sequence Macro Attributes”</a>
                                 </span>
                              </p>
                           </td>
                           <td align="left" rowspan="1" colspan="1">
                              <p>
                                 <span class="italic">Baseline <a href="../part16/sect_CID_7100.html" class="olink" shape="rect">CID 7100 “RCS Registration Method Type”</a>.</span>
                              </p>
                           </td>
                        </tr>
                        <tr valign="top">
                           <td align="left" rowspan="1" colspan="1">
                              <p>&gt;Pre Deformation Matrix Registration Sequence</p>
                           </td>
                           <td align="center" rowspan="1" colspan="1">
                              <p>(0064,000F)</p>
                           </td>
                           <td align="center" rowspan="1" colspan="1">
                              <p>1C</p>
                           </td>
                           <td align="left" rowspan="1" colspan="1">
                              <p>A sequence that specifies one spatial registration to be applied prior to the deformation.</p>
                              <p>Only a single Item shall be included in this sequence.</p>
                              <p>Required if a matrix transformation is to be applied prior to deformation.</p>
                           </td>
                        </tr>
                        <tr valign="top">
                           <td align="left" rowspan="1" colspan="1">
                              <p>&gt;&gt;Frame of Reference Transformation Matrix</p>
                           </td>
                           <td align="center" rowspan="1" colspan="1">
                              <p>(3006,00C6)</p>
                           </td>
                           <td align="center" rowspan="1" colspan="1">
                              <p>1</p>
                           </td>
                           <td align="left" rowspan="1" colspan="1">
                              <p>A 4x4 homogeneous transformation matrix.Matrix elements shall be listed in row-major order. See <a class="xref" href="sect_C.20.html#sect_C.20.2.1.1" title="C.20.2.1.1 Frame of Reference Transformation Matrix" shape="rect">Section C.20.2.1.1</a>.</p>
                           </td>
                        </tr>
                        <tr valign="top">
                           <td align="left" rowspan="1" colspan="1">
                              <p>&gt;&gt;Frame of Reference Transformation Matrix Type</p>
                           </td>
                           <td align="center" rowspan="1" colspan="1">
                              <p>(0070,030C)</p>
                           </td>
                           <td align="center" rowspan="1" colspan="1">
                              <p>1</p>
                           </td>
                           <td align="left" rowspan="1" colspan="1">
                              <p>Type of Frame of Reference Transformation Matrix (3006,00C6).</p>
                              <div class="variablelist">
                                 <p class="title">
                                    <strong>Enumerated Values:</strong>
                                 </p>
                                 <dl class="variablelist compact">
                                    <dt>
                                       <span class="term">RIGID</span>
                                    </dt>
                                    <dd>
                                       <p></p>
                                    </dd>
                                    <dt>
                                       <span class="term">RIGID_SCALE</span>
                                    </dt>
                                    <dd>
                                       <p></p>
                                    </dd>
                                    <dt>
                                       <span class="term">AFFINE</span>
                                    </dt>
                                    <dd>
                                       <p></p>
                                    </dd>
                                 </dl>
                              </div>
                              <p>See <a class="xref" href="sect_C.20.html#sect_C.20.2.1.2" title="C.20.2.1.2 Frame of Reference Transformation Matrix Type" shape="rect">Section C.20.2.1.2</a>
                              </p>
                           </td>
                        </tr>
                        <tr valign="top">
                           <td align="left" rowspan="1" colspan="1">
                              <p>&gt;Post Deformation Matrix Registration Sequence</p>
                           </td>
                           <td align="center" rowspan="1" colspan="1">
                              <p>(0064,0010)</p>
                           </td>
                           <td align="center" rowspan="1" colspan="1">
                              <p>1C</p>
                           </td>
                           <td align="left" rowspan="1" colspan="1">
                              <p>A sequence that specifies one spatial registration to be applied after the application of the deformation.</p>
                              <p>Only a single Item shall be included in this sequence.</p>
                              <p>Required if matrix transformation is to be performed after application of the deformation.</p>
                           </td>
                        </tr>
                        <tr valign="top">
                           <td align="left" rowspan="1" colspan="1">
                              <p>&gt;&gt;Frame of Reference Transformation Matrix</p>
                           </td>
                           <td align="center" rowspan="1" colspan="1">
                              <p>(3006,00C6)</p>
                           </td>
                           <td align="center" rowspan="1" colspan="1">
                              <p>1</p>
                           </td>
                           <td align="left" rowspan="1" colspan="1">
                              <p>A 4x4 homogeneous transformation matrix. Matrix elements shall be listed in row-major order. See <a class="xref" href="sect_C.20.html#sect_C.20.2.1.1" title="C.20.2.1.1 Frame of Reference Transformation Matrix" shape="rect">Section C.20.2.1.1</a>.</p>
                           </td>
                        </tr>
                        <tr valign="top">
                           <td align="left" rowspan="1" colspan="1">
                              <p>&gt;&gt;Frame of Reference Transformation Matrix Type</p>
                           </td>
                           <td align="center" rowspan="1" colspan="1">
                              <p>(0070,030C)</p>
                           </td>
                           <td align="center" rowspan="1" colspan="1">
                              <p>1</p>
                           </td>
                           <td align="left" rowspan="1" colspan="1">
                              <p>Type of Frame of Reference Transformation Matrix (3006,00C6).</p>
                              <div class="variablelist">
                                 <p class="title">
                                    <strong>Defined Terms:</strong>
                                 </p>
                                 <dl class="variablelist compact">
                                    <dt>
                                       <span class="term">RIGID</span>
                                    </dt>
                                    <dd>
                                       <p></p>
                                    </dd>
                                    <dt>
                                       <span class="term">RIGID_SCALE</span>
                                    </dt>
                                    <dd>
                                       <p></p>
                                    </dd>
                                    <dt>
                                       <span class="term">AFFINE</span>
                                    </dt>
                                    <dd>
                                       <p></p>
                                    </dd>
                                 </dl>
                              </div>
                              <p>See <a class="xref" href="sect_C.20.html#sect_C.20.2.1.2" title="C.20.2.1.2 Frame of Reference Transformation Matrix Type" shape="rect">Section C.20.2.1.2</a>
                              </p>
                           </td>
                        </tr>
                        <tr valign="top">
                           <td align="left" rowspan="1" colspan="1">
                              <p>&gt;Deformable Registration Grid Sequence</p>
                           </td>
                           <td align="center" rowspan="1" colspan="1">
                              <p>(0064,0005)</p>
                           </td>
                           <td align="center" rowspan="1" colspan="1">
                              <p>1C</p>
                           </td>
                           <td align="left" rowspan="1" colspan="1">
                              <p>Describes the deformation grid used to sample into the Source RCS.</p>
                              <p>Only a single Item shall be included in this sequence.</p>
                              <p>Required if deformation is performed. See <a class="xref" href="sect_C.20.html#sect_C.20.3.1.2" title="C.20.3.1.2 Deformable Registration Grid Sequence" shape="rect">Section C.20.3.1.2</a>.</p>
                           </td>
                        </tr>
                        <tr valign="top">
                           <td align="left" rowspan="1" colspan="1">
                              <p>&gt;&gt;Image Orientation (Patient)</p>
                           </td>
                           <td align="center" rowspan="1" colspan="1">
                              <p>(0020,0037)</p>
                           </td>
                           <td align="center" rowspan="1" colspan="1">
                              <p>1</p>
                           </td>
                           <td align="left" rowspan="1" colspan="1">
                              <p>The direction of cosines of the first row and first column of the Vector Grid Data (0064,0009) with respect to the patient. See <a class="xref" href="sect_C.7.html#sect_C.7.6.2.1.1" title="C.7.6.2.1.1 Image Position and Image Orientation" shape="rect">Section C.7.6.2.1.1</a> for further explanation.</p>
                           </td>
                        </tr>
                        <tr valign="top">
                           <td align="left" rowspan="1" colspan="1">
                              <p>&gt;&gt;Image Position (Patient)</p>
                           </td>
                           <td align="center" rowspan="1" colspan="1">
                              <p>(0020,0032)</p>
                           </td>
                           <td align="center" rowspan="1" colspan="1">
                              <p>1</p>
                           </td>
                           <td align="left" rowspan="1" colspan="1">
                              <p>The x, y, and z coordinates of the upper left hand voxel (center of the first voxel transmitted) of the grid, in mm in the Registered Frame of Reference. See <a class="xref" href="sect_C.7.html#sect_C.7.6.2.1.1" title="C.7.6.2.1.1 Image Position and Image Orientation" shape="rect">Section C.7.6.2.1.1</a> for further explanation.</p>
                           </td>
                        </tr>
                        <tr valign="top">
                           <td align="left" rowspan="1" colspan="1">
                              <p>&gt;&gt;Grid Dimensions</p>
                           </td>
                           <td align="center" rowspan="1" colspan="1">
                              <p>(0064,0007)</p>
                           </td>
                           <td align="center" rowspan="1" colspan="1">
                              <p>1</p>
                           </td>
                           <td align="left" rowspan="1" colspan="1">
                              <p>The dimensions of the grid, in voxels. A triple representing the number of voxels along the X, Y, and Z axes.</p>
                           </td>
                        </tr>
                        <tr valign="top">
                           <td align="left" rowspan="1" colspan="1">
                              <p>&gt;&gt;Grid Resolution</p>
                           </td>
                           <td align="center" rowspan="1" colspan="1">
                              <p>(0064,0008)</p>
                           </td>
                           <td align="center" rowspan="1" colspan="1">
                              <p>1</p>
                           </td>
                           <td align="left" rowspan="1" colspan="1">
                              <p>The resolution of the grid voxels. A triple representing the size of a deformation voxel in along the X, Y, and Z dimension, in mm.</p>
                           </td>
                        </tr>
                        <tr valign="top">
                           <td align="left" rowspan="1" colspan="1">
                              <p>&gt;&gt;Vector Grid Data</p>
                           </td>
                           <td align="center" rowspan="1" colspan="1">
                              <p>(0064,0009)</p>
                           </td>
                           <td align="center" rowspan="1" colspan="1">
                              <p>1</p>
                           </td>
                           <td align="left" rowspan="1" colspan="1">
                              <p>A data stream of vectors. See <a class="xref" href="sect_C.20.html#sect_C.20.3.1.3" title="C.20.3.1.3 Vector Grid Data" shape="rect">Section C.20.3.1.3</a> for further explanation.</p>
                           </td>
                        </tr>
                        <tr valign="top">
                           <td align="left" rowspan="1" colspan="1">
                              <p>&gt;Used Fiducials Sequence</p>
                           </td>
                           <td align="center" rowspan="1" colspan="1">
                              <p>(0070,0314)</p>
                           </td>
                           <td align="center" rowspan="1" colspan="1">
                              <p>3</p>
                           </td>
                           <td align="left" rowspan="1" colspan="1">
                              <p>The fiducials used to determine the registration.</p>
                              <p>One or more Items are permitted in this sequence.</p>
                           </td>
                        </tr>
                        <tr valign="top">
                           <td align="left" colspan="3" rowspan="1">
                              <p>
                                 <span class="italic">&gt;&gt;Include <a class="xref" href="sect_10.8.html#table_10-11" title="Table 10-11. SOP Instance Reference Macro Attributes" shape="rect">Table 10-11 “SOP Instance Reference Macro Attributes”</a>
                                 </span>
                              </p>
                           </td>
                           <td align="left" rowspan="1" colspan="1">
                              <p>Reference to the Spatial Fiducial SOP Instance identifying the Used Fiducial(s)</p>
                           </td>
                        </tr>
                        <tr valign="top">
                           <td align="left" rowspan="1" colspan="1">
                              <p>&gt;&gt;Fiducial UID</p>
                           </td>
                           <td align="center" rowspan="1" colspan="1">
                              <p>(0070,031A)</p>
                           </td>
                           <td align="center" rowspan="1" colspan="1">
                              <p>1</p>
                           </td>
                           <td align="left" rowspan="1" colspan="1">
                              <p>The UID that identifies the fiducial used as registration input.</p>
                           </td>
                        </tr>
                     </tbody>
                  </table>
               </div>
            </div>
            <br class="table-break" clear="none" />
            <div class="section">
               <div class="titlepage">
                  <div>
                     <div>
                        <h4 class="title">
                           <a id="sect_C.20.3.1" shape="rect"></a>C.20.3.1 Deformable Spatial Registration Module Attribute Descriptions</h4>
                     </div>
                  </div>
               </div>
               <div class="section">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h5 class="title">
                              <a id="sect_C.20.3.1.1" shape="rect"></a>C.20.3.1.1 Deformable Registration Sequence Application</h5>
                        </div>
                     </div>
                  </div>
                  <p>The registrations in this module are applied to the Registered RCS coordinates in the following order. First, transform the coordinates using the matrix described in the Pre Deformation Matrix Registration Sequence (0064,000F). Next apply the deformation offsets to the resulting coordinates. Finally, transform those coordinates using the matrix described in the Post Deformation Matrix Registration Sequence (0064,0010). The resulting coordinate addresses the sample point within the Source RCS.</p>
                  <p>Thus a source coordinate may be calculated using <a class="xref" href="sect_C.20.html#equation_C.20.3-1" title="Equation C.20.3-1. " shape="rect">Equation C.20.3-1</a> (this assumes that the center position of each deformation voxel will be transformed).</p>
                  <p>
              </p>
                  <div class="equation">
                     <a id="equation_C.20.3-1" shape="rect"></a>
                     <p class="title">
                        <strong>Equation C.20.3-1. </strong>
                     </p>
                     <div class="equation-contents">
                        <object type="image/svg+xml" data="sect_C_image_5.svg" style="">
                           <param name="src" value="image_5.svg" />
                        </object>
                     </div>
                  </div>
                  <p>
                     <br class="equation-break" clear="none" />
                  </p>
                  <p>Where:</p>
                  <div class="informaltable">
                     <table frame="void" rules="none">
                        <tbody>
                           <tr valign="top">
                              <td align="left" rowspan="1" colspan="1">
                                 <p>
                      </p>
                                 <div class="informalequation">
                                    <object type="image/svg+xml" data="sect_C_image_6.svg" style="position: relative; bottom: -6.743475px;">
                                       <param name="src" value="image_6.svg" />
                                    </object>
                                 </div>
                                 <p>
                    </p>
                              </td>
                              <td align="left" rowspan="1" colspan="1">
                                 <p>The spatial coordinate in the Source RCS.</p>
                              </td>
                           </tr>
                           <tr valign="top">
                              <td align="left" rowspan="1" colspan="1">
                                 <p>
                      </p>
                                 <div class="informalequation">
                                    <object type="image/svg+xml" data="sect_C_image_7.svg" style="position: relative; bottom: -6.743475px;">
                                       <param name="src" value="image_7.svg" />
                                    </object>
                                 </div>
                                 <p>
                    </p>
                              </td>
                              <td align="left" rowspan="1" colspan="1">
                                 <p>The start coordinate, in the Registered RCS, of the deformation grid as specified in Image Position (Patient) (0020,0032).</p>
                              </td>
                           </tr>
                           <tr valign="top">
                              <td align="left" rowspan="1" colspan="1">
                                 <p>
                      </p>
                                 <div class="informalequation">
                                    <object type="image/svg+xml" data="sect_C_image_8.svg" style="position: relative; bottom: -6.668924999999998px;">
                                       <param name="src" value="image_8.svg" />
                                    </object>
                                 </div>
                                 <p>
                    </p>
                              </td>
                              <td align="left" rowspan="1" colspan="1">
                                 <p>The values from the row (X) direction cosine of Image Orientation (Patient) (0020,0037).</p>
                              </td>
                           </tr>
                           <tr valign="top">
                              <td align="left" rowspan="1" colspan="1">
                                 <p>
                      </p>
                                 <div class="informalequation">
                                    <object type="image/svg+xml" data="sect_C_image_9.svg" style="position: relative; bottom: -6.8286750000000005px;">
                                       <param name="src" value="image_9.svg" />
                                    </object>
                                 </div>
                                 <p>
                    </p>
                              </td>
                              <td align="left" rowspan="1" colspan="1">
                                 <p>The values from the column (Y) direction cosine of Image Orientation (Patient) (0020,0037).</p>
                              </td>
                           </tr>
                           <tr valign="top">
                              <td align="left" rowspan="1" colspan="1">
                                 <p>
                      </p>
                                 <div class="informalequation">
                                    <object type="image/svg+xml" data="sect_C_image_10.svg" style="position: relative; bottom: -8.820225px;">
                                       <param name="src" value="image_10.svg" />
                                    </object>
                                 </div>
                                 <p>
                    </p>
                              </td>
                              <td align="left" rowspan="2" colspan="1">
                                 <p>The cross product between the row (X) direction cosine and the column (Y) direction cosine of Image Orientation (Patient) (0020,0037).</p>
                              </td>
                           </tr>
                           <tr valign="top">
                              <td align="left" rowspan="1" colspan="1">
                                 <p>
                      </p>
                                 <div class="informalequation">
                                    <object type="image/svg+xml" data="sect_C_image_11.svg" style="position: relative; bottom: -8.820225px;">
                                       <param name="src" value="image_11.svg" />
                                    </object>
                                 </div>
                                 <p>
                    </p>
                              </td>
                           </tr>
                           <tr valign="top">
                              <td align="left" rowspan="1" colspan="1">
                                 <p>
                      </p>
                                 <div class="informalequation">
                                    <object type="image/svg+xml" data="sect_C_image_12.svg" style="position: relative; bottom: -5.82px;">
                                       <param name="src" value="image_12.svg" />
                                    </object>
                                 </div>
                                 <p>
                    </p>
                              </td>
                              <td align="left" rowspan="1" colspan="1">
                                 <p>The index into the deformation grid in the X, Y, and Z dimension.</p>
                              </td>
                           </tr>
                           <tr valign="top">
                              <td align="left" rowspan="1" colspan="1">
                                 <p>
                      </p>
                                 <div class="informalequation">
                                    <object type="image/svg+xml" data="sect_C_image_13.svg" style="position: relative; bottom: -6.477225000000001px;">
                                       <param name="src" value="image_13.svg" />
                                    </object>
                                 </div>
                                 <p>
                    </p>
                              </td>
                              <td align="left" rowspan="1" colspan="1">
                                 <p>The resolution of the deformation grid in the X, Y, and Z dimension as specified in Grid Resolution (0064,0008).</p>
                              </td>
                           </tr>
                           <tr valign="top">
                              <td align="left" rowspan="1" colspan="1">
                                 <p>
                      </p>
                                 <div class="informalequation">
                                    <object type="image/svg+xml" data="sect_C_image_14.svg" style="position: relative; bottom: -7.0757625px;">
                                       <param name="src" value="image_14.svg" />
                                    </object>
                                 </div>
                                 <p>
                    </p>
                              </td>
                              <td align="left" rowspan="1" colspan="1">
                                 <p>The deformation specified at index (i,j,k) in the deformation grid. If the Deformation Registration Grid Sequence (0064,0005) has no items, the D values are zero.</p>
                              </td>
                           </tr>
                           <tr>
                              <td align="left" rowspan="1" colspan="1">
                                 <p>
                      </p>
                                 <div class="informalequation">
                                    <span class="mathphrase">M<sub>Pre</sub>
                                    </span>
                                 </div>
                                 <p>
                    </p>
                              </td>
                              <td align="left" rowspan="1" colspan="1">
                                 <p>The transformation matrix specified in the Pre Deformation Matrix Registration Sequence (0064,000F).</p>
                              </td>
                           </tr>
                           <tr valign="top">
                              <td align="left" rowspan="1" colspan="1">
                                 <div class="informalequation">
                                    <span class="mathphrase">M<sub>Post</sub>
                                    </span>
                                 </div>
                              </td>
                              <td align="left" rowspan="1" colspan="1">
                                 <p>The transformation matrix specified in the Post Deformation Matrix Registration Sequence (0064,0010).</p>
                              </td>
                           </tr>
                        </tbody>
                     </table>
                  </div>
               </div>
               <div class="section">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h5 class="title">
                              <a id="sect_C.20.3.1.2" shape="rect"></a>C.20.3.1.2 Deformable Registration Grid Sequence</h5>
                        </div>
                     </div>
                  </div>
                  <p>The vector represents the deformation at the center of the voxel. Deformations between voxel centers shall be determined through interpolation of the surrounding vectors in an implementation dependent manner.</p>
               </div>
               <div class="section">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h5 class="title">
                              <a id="sect_C.20.3.1.3" shape="rect"></a>C.20.3.1.3 Vector Grid Data</h5>
                        </div>
                     </div>
                  </div>
                  <p>Vector Grid Data (0064,0009) contains the vector data. Each voxel in Vector Grid Data (0064,0009) is represented by an </p>
                  <div class="informalequation">
                     <object type="image/svg+xml" data="sect_C_image_15.svg" style="position: relative; bottom: -7.0757625px;">
                        <param name="src" value="image_15.svg" />
                     </object>
                  </div>
                  <p> vector. The vector describes the direction and magnitude of the deformation at the center of the deformation voxel.</p>
                  <p>The order of vectors sent for each vector plane shall be left to right, top to bottom, i.e., the upper left vector (labeled 1,1) is sent first followed by the remainder of row 1, followed by the first vector of row 2 (labeled 2,1) then the remainder of row 2 and so on.</p>
                  <p>A vector triple with values of (NaN,NaN,NaN) shall indicate that the transformation at that point of the deformation grid is undefined.</p>
                  <p>The size of this attribute value is determined by the dimensions specified in Grid Dimensions (0064,0007). For dimensions of X<sub>D</sub>\Y<sub>D</sub>\Z<sub>D</sub>, the size of the attribute value can be calculated with <a class="xref" href="sect_C.20.html#equation_C.20.3-2" title="Equation C.20.3-2. " shape="rect">Equation C.20.3-2</a>.</p>
                  <p>
              </p>
                  <div class="equation">
                     <a id="equation_C.20.3-2" shape="rect"></a>
                     <p class="title">
                        <strong>Equation C.20.3-2. </strong>
                     </p>
                     <div class="equation-contents">
                        <span class="mathphrase">Number of Bytes = X<sub>D</sub> * Y<sub>D</sub> * Z<sub>D</sub> * 3 * 4</span>
                     </div>
                  </div>
                  <p>
                     <br class="equation-break" clear="none" />
                  </p>
               </div>
            </div>
         </div>
      </div>
      <div class="navfooter">
         <hr />
         <table width="100%" summary="Navigation footer">
            <tr>
               <td width="40%" align="left" rowspan="1" colspan="1">
                  <a accesskey="p" href="sect_C.19.html" shape="rect">Prev</a> </td>
               <td width="20%" align="center" rowspan="1" colspan="1">
                  <a accesskey="u" href="chapter_C.html" shape="rect">Up</a>
               </td>
               <td width="40%" align="right" rowspan="1" colspan="1"> <a accesskey="n" href="sect_C.21.html" shape="rect">Next</a>
               </td>
            </tr>
            <tr>
               <td width="40%" align="left" valign="top" rowspan="1" colspan="1">C.19 Raw Data Specific Modules </td>
               <td width="20%" align="center" rowspan="1" colspan="1">
                  <a accesskey="h" href="PS3.3.html" shape="rect">Home</a>
               </td>
               <td width="40%" align="right" valign="top" rowspan="1" colspan="1"> C.21 Spatial Fiducials</td>
            </tr>
         </table>
      </div>
   </body>
</html>
